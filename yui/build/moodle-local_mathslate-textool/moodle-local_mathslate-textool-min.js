YUI.add("moodle-local_mathslate-textool",function(e,t){M.local_mathslate=M.local_mathslate||{},M.local_mathslate.TeXTool=function(t){var n=e.Node.create('<input type="text">'),r=e.Node.create("<span>\\( \\)</span>");e.one(t).appendChild(n),e.one(t).appendChild(r);var i=new e.DD.Drag({node:r});i.on("drag:end",function(){this.get("node").setStyle("top","0"),this.get("node").setStyle("left","0")}),n.on("change",function(){function s(){var i=MathJax.Hub.getAllJax(r.generateID())[0].root.toMathML();i=i.replace(/.*<math xmlns=\"http:\/\/www.w3.org\/1998\/Math\/MathML\">\s*/,"[").replace(/\s*<\/math.*/,"]");if(/<mtext mathcolor="red">/.test(i)){t=[""],r.json=null,r.setHTML("Unrecognized Expression");return}t=i.replace("<mrow>",'["mrow",{"tex": "'+n.getDOMNode().value+'"},['),t=t.replace(/ class="[^"]*"/g,""),["mrow","mfrac","msub","msup","msubsup","munder","mover","munderover","msqrt","mroot"].forEach(function(e){t=t.replace(new RegExp("<"+e+">","g"),'["'+e+'",{},[').replace(new RegExp("</"+e+">","g"),"]],")}),t=t.replace(/<mo stretchy="false">/g,'["mo",{"stretchy": "false"},"'),["mo","mi","mn","mtext"].forEach(function(e){t=t.replace(new RegExp("<"+e+">","g"),'["'+e+'",{},"').replace(new RegExp("</"+e+">","g"),'"],')}),t=t.replace(/<mi mathvariant="italic">/g,'["mi",{"mathvariant": "italic"},"'),t=t.replace(/,\s*\]/g,"]"),t=t.replace(/\\/g,"\\\\"),t=t.replace(/<!--.*?-->/g,""),t=t.replace(/&#x([\dA-F]{4});/g,"\\u$1"),t='["mrow", {"tex":["'+n.getDOMNode().value.replace(/\\/g,"\\\\")+'"]},'+t+"]",r.json=t,t=[e.JSON.parse(t)],r.setHTML("")}r.setHTML("<span>\\("+n.getDOMNode().value+"\\)</span>"),MathJax.Hub.Queue(["Typeset",MathJax.Hub,r.generateID()]);var t;MathJax.Hub.Queue(s),MathJax.Hub.Queue(["addElement",MathJax.HTML,r.getDOMNode(),"span",{},[["math",{},t]]]),MathJax.Hub.Queue(["Typeset",MathJax.Hub,r.generateID()]),MathJax.Hub.Queue(function(){i.set("data",r.json)})})}},"@VERSION@",{requires:["dd-drag","dd-proxy","dd-drop","event","json"]});
